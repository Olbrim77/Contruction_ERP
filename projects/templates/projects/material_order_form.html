{% extends 'projects/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block breadcrumbs %}
    <a href="{% url 'project-list' %}">Projektek</a> /
    <a href="{% url 'project-detail' project.id %}">{{ project.name }}</a> /
    <span>{{ title }}</span>
{% endblock %}

{% block extra_css %}
<style>
    .form-card { background: #fff; padding: 30px; border-radius: 12px; border: 1px solid var(--border); max-width: 900px; margin: 0 auto; }

    h3 { color: var(--primary); margin-top: 0; border-bottom: 2px solid #f4f6f9; padding-bottom: 10px; margin-bottom: 20px; }

    /* Űrlap mezők */
    label { display: block; font-weight: 600; margin-bottom: 5px; color: #555; font-size: 0.9em; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-bottom: 15px; }

    /* Táblázat */
    .excel-table { width: 100%; border-collapse: collapse; margin-top: 10px; background: #fff; }
    .excel-table th { background: #f8f9fa; text-align: left; padding: 10px; border-bottom: 2px solid #eee; color: #555; font-size: 0.9em; }
    .excel-table td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; }
    .excel-table input { margin-bottom: 0; } /* Táblázaton belül ne legyen alsó margó */

    .btn-group { text-align: right; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }
</style>
{% endblock %}

{% block content %}
<div class="form-card">
    <form method="POST">
        {% csrf_token %}

        <div style="background: #fcfcfc; padding: 20px; border-radius: 8px; border: 1px dashed #ddd; margin-bottom: 30px;">
            <h3>1. Rendelés Adatai</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label>Beszállító</label>
                    {{ form.supplier }}
                </div>
                <div>
                    <label>Dátum</label>
                    {{ form.date }}
                </div>
            </div>
            <div style="margin-top: 15px;">
                <label>Státusz</label>
                {{ form.status }}
            </div>
            <div style="margin-top: 15px;">
                <label>Megjegyzés (pl. szállítási infók)</label>
                {{ form.notes }}
            </div>
        </div>

        <h3>2. Megrendelt Tételek</h3>
        {{ formset.management_form }}

        <div style="overflow-x: auto;">
            <table class="excel-table">
                <thead>
                    <tr>
                        <th width="40%">Megnevezés</th>
                        <th width="15%">Mennyiség</th>
                        <th width="10%">Egység</th>
                        <th width="20%">Becsült Ár (Ft)</th>
                        <th width="5%" style="text-align: center;">Törlés</th>
                    </tr>
                </thead>
                <tbody>
                    {% for f in formset %}
                    <tr>
                        {% for hidden in f.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}

                        <td>{{ f.name }}</td>
                        <td>{{ f.quantity }}</td>
                        <td>{{ f.unit }}</td>
                        <td>{{ f.price }}</td>
                        <td style="text-align: center;">
                            {% if formset.can_delete %}
                                {{ f.DELETE }}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <p style="color: #666; font-size: 0.85em; margin-top: 10px;">* Ha üres sort hagysz, az nem kerül mentésre.</p>

        <div class="btn-group">
            <a href="{% url 'project-detail' project.id %}" class="btn btn-secondary">Mégse</a>
            <button type="submit" class="btn btn-success"><i class="fa-solid fa-floppy-disk"></i> Rendelés Mentése</button>
        </div>
    </form>
</div>
{% endblock %}