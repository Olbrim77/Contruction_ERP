{% extends 'projects/base.html' %}
{% load humanize %}

{% block title %}K√∂lts√©gvet√©si Adatt√∂rzs - Kocsis √âp√≠t≈ë{% endblock %}

{% block breadcrumbs %}
    <a href="{% url 'project-list' %}">Kezd≈ëlap</a> / <span>Katal√≥gus</span>
{% endblock %}

{% block extra_css %}
<style>
    /* SZ≈∞R≈ê S√ÅV */
    .filter-bar {
        background-color: #fff; padding: 20px; border-radius: 8px;
        border: 1px solid var(--border); display: flex; gap: 15px;
        margin-bottom: 30px; align-items: center; flex-wrap: wrap;
    }
    .filter-group { flex-grow: 1; display: flex; gap: 10px; }
    input, select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; flex: 1; }

    /* T√ÅBL√ÅZAT */
    .data-table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; border: 1px solid var(--border); font-size: 14px; }
    .data-table th { background: #f8f9fa; text-align: left; padding: 15px; color: var(--secondary); border-bottom: 1px solid #eee; }
    .data-table td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
    .data-table tr:hover { background-color: #fcfcfc; }

    .numeric { text-align: right; font-family: monospace; font-size: 1.1em; }
    .badge-cat { background: #e9ecef; color: #555; padding: 4px 8px; border-radius: 4px; font-size: 12px; }

    /* M≈∞VELETEK */
    .actions { display: flex; gap: 5px; justify-content: center; }
    .btn-icon {
        width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
        border-radius: 4px; text-decoration: none; color: #555; background: #f8f9fa; border: 1px solid #ddd;
    }
    .btn-icon:hover { background: #e2e6ea; }
    .btn-icon.red:hover { background: #fee2e2; color: #dc3545; border-color: #dc3545; }
</style>
{% endblock %}

{% block content %}

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h2 style="margin:0;">üìö K√∂lts√©gvet√©si Adatt√∂rzs</h2>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'master-item-import' %}" class="btn btn-secondary"><i class="fa-solid fa-file-import"></i> Excel Import</a>
            <a href="{% url 'master-item-create' %}" class="btn btn-success"><i class="fa-solid fa-plus"></i> √öj T√©tel</a>
        </div>
    </div>

    <form method="GET" class="filter-bar">
        <div class="filter-group">
            <input type="text" name="q" placeholder="Keres√©s n√©v vagy k√≥d alapj√°n..." value="{{ search_query }}">
            <select name="munkanem" onchange="this.form.submit()">
                <option value="">-- Minden Munkanem --</option>
                {% for m in munkanemek %}
                    <option value="{{ m.id }}" {% if current_munkanem == m.id %}selected{% endif %}>{{ m.nev }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Keres√©s</button>
        {% if search_query or current_munkanem %}
            <a href="{% url 'master-item-list' %}" class="btn btn-secondary" style="background:none; color:#d9534f; border:none;">Sz≈±r√©s t√∂rl√©se</a>
        {% endif %}
    </form>

    <table class="data-table">
        <thead>
            <tr>
                <th width="15%">T√©telsz√°m</th>
                <th width="40%">Megnevez√©s</th>
                <th width="10%">Egys√©g</th>
                <th width="15%">Munkanem</th>
                <th width="10%" class="numeric">Norma</th>
                <th width="10%" class="numeric">Anyag√°r</th>
                <th width="10%" style="text-align:center;">M≈±veletek</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td style="font-weight:600; color:var(--primary);">{{ item.tetelszam }}</td>
                <td>{{ item.leiras|truncatechars:80 }}</td>
                <td>{{ item.egyseg }}</td>
                <td><span class="badge-cat">{{ item.munkanem|default:"-" }}</span></td>
                <td class="numeric">{{ item.normaido }} √≥</td>
                <td class="numeric">{{ item.fix_anyag_ar|floatformat:0|intcomma }} Ft</td>
                <td>
                    <div class="actions">
                        <a href="{% url 'master-item-components' item.id %}" class="btn-icon" title="Recept√∫ra"><i class="fa-solid fa-flask"></i></a>
                        <a href="{% url 'master-item-update' item.id %}" class="btn-icon" title="Szerkeszt√©s"><i class="fa-solid fa-pen"></i></a>
                        <a href="{% url 'master-item-delete' item.id %}" class="btn-icon red" title="T√∂rl√©s"><i class="fa-solid fa-trash"></i></a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">Nincs tal√°lat a katal√≥gusban.</td></tr>
            {% endfor %}
        </tbody>
    </table>

{% endblock %}