{% extends 'projects/base.html' %}
{% load humanize %}

{% block title %}HR √©s B√©rsz√°mfejt√©s{% endblock %}

{% block extra_css %}
<style>
    .hr-container {
        max-width: 1200px;
        margin: 20px auto;
        background: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border: 1px solid #ddd;
    }

    /* FEJL√âC */
    .hr-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 15px;
    }

    .hr-header h2 { margin: 0; color: #005a9c; }

    /* Gombok */
    .header-buttons { display: flex; gap: 15px; align-items: center; }

    /* H√≥nap v√°laszt√≥ */
    .month-selector {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #f8f9fa;
        padding: 10px 15px;
        border-radius: 6px;
        border: 1px solid #e1e4e8;
    }
    .month-selector input {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
    }
    .month-selector label { font-weight: bold; color: #555; }

    /* T√ÅBL√ÅZAT */
    .hr-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        margin-top: 10px;
    }

    .hr-table th {
        background: #f1f1f1;
        text-align: left;
        padding: 12px;
        border-bottom: 2px solid #ccc;
        color: #444;
    }

    .hr-table td {
        padding: 12px;
        border-bottom: 1px solid #eee;
        vertical-align: middle;
    }

    .hr-table tr:hover { background-color: #fcfcfc; }

    /* Sz√°mok form√°z√°sa */
    .numeric { text-align: right; font-family: monospace; font-size: 1.1em; }

    .text-success { color: #28a745; }
    .text-danger { color: #dc3545; }
    .text-muted { color: #aaa; }

    .final-pay {
        font-weight: bold;
        font-size: 1.2em;
        color: #333;
        border-left: 3px solid #eee;
        padding-left: 15px !important;
    }

    /* R√©szletek Gomb */
    .btn-details {
        background-color: #6c757d;
        color: white;
        text-decoration: none;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        transition: background 0.2s;
        display: inline-block;
    }
    .btn-details:hover { background-color: #545b62; }

    /* Napt√°r Gomb */
    .btn-calendar {
        background-color: #17a2b8;
        color: white;
        text-decoration: none;
        padding: 10px 15px;
        border-radius: 6px;
        font-weight: bold;
        display: flex; align-items: center; gap: 5px;
    }
    .btn-calendar:hover { background-color: #138496; }

</style>
{% endblock %}

{% block content %}
<div class="hr-container">

    <div class="hr-header">
        <div>
            <h2>üë• Havi B√©rsz√°mfejt√©s</h2>
            <p style="margin:5px 0 0 0; color:#666;">
                Id≈ëszak: <strong>{{ selected_date|date:"Y. F" }}</strong>
            </p>
        </div>

        <div class="header-buttons">
            <form method="GET" class="month-selector">
                <label>V√°lassz h√≥napot:</label>
                <input type="month" name="month" value="{{ selected_date|date:'Y-m' }}" onchange="this.form.submit()">
            </form>

            <a href="{% url 'hr-calendar' %}?month={{ selected_date|date:'Y-m' }}" class="btn-calendar">
                üìÖ Napt√°r N√©zet
            </a>
        </div>
    </div>

    <table class="hr-table">
        <thead>
            <tr>
                <th style="width: 20%;">Dolgoz√≥</th>
                <th class="numeric" style="width: 10%;">√ìr√°k</th>
                <th class="numeric" style="width: 12%;">Alapb√©r</th>
                <th class="numeric" style="width: 12%;">+ Pr√©mium</th>
                <th class="numeric" style="width: 12%;">- El≈ëleg</th>
                <th class="numeric" style="width: 12%;">- Levon√°s</th>
                <th class="numeric" style="width: 15%;">Kifizetend≈ë</th>
                <th style="text-align:center;">M≈±velet</th>
            </tr>
        </thead>
        <tbody>
            {% for row in payroll_data %}
            <tr>
                <td>
                    <strong style="font-size:1.1em; color:#005a9c;">{{ row.employee.name }}</strong><br>
                    <small style="color:#666;">{{ row.employee.position }}</small>
                </td>

                <td class="numeric">
                    {% if row.hours > 0 %}
                        <strong>{{ row.hours }}</strong> √≥ra
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>

                <td class="numeric">{{ row.base_salary|floatformat:0|intcomma }} Ft</td>

                <td class="numeric text-success">
                    {% if row.premiums > 0 %}+{{ row.premiums|floatformat:0|intcomma }}{% else %}-{% endif %}
                </td>

                <td class="numeric text-danger">
                    {% if row.advances > 0 %}-{{ row.advances|floatformat:0|intcomma }}{% else %}-{% endif %}
                </td>

                <td class="numeric text-danger">
                    {% if row.deductions > 0 %}-{{ row.deductions|floatformat:0|intcomma }}{% else %}-{% endif %}
                </td>

                <td class="numeric final-pay">
                    {{ row.final_pay|floatformat:0|intcomma }} Ft
                </td>

                <td style="text-align:center;">
                    <a href="{% url 'employee-monthly-detail' row.employee.id selected_date.year selected_date.month %}" class="btn-details">
                        R√©szletek ‚ûú
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" style="text-align:center; padding:40px; color:#999;">
                    <div style="font-size: 40px; margin-bottom: 10px;">üì≠</div>
                    Nincsenek akt√≠v dolgoz√≥k vagy adatok erre a h√≥napra.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 20px; font-size: 0.9em; color: #888; text-align: right;">
        * A sz√°m√≠t√°s alapja: (Ledolgozott √≥ra √ó Napi b√©r / 8) + Pr√©mium - El≈ëleg - Levon√°s
    </div>

</div>
{% endblock %}