{% extends 'projects/base.html' %}
{% load humanize %}

{% block title %}Recept√∫ra Szerkeszt√©se{% endblock %}

{% block extra_css %}
<style>
    .container { max-width: 1000px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; }
    .item-info { background: #f0f4f8; padding: 20px; border-left: 5px solid #005a9c; margin-bottom: 30px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
    th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
    th { background: #f8f9fa; }
    .add-form { background: #eef2f7; padding: 15px; display: flex; gap: 10px; align-items: flex-end; margin-bottom: 30px; border-radius: 4px; }
    .add-form select, .add-form input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .btn-add { background: #28a745; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap; }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <a href="{% url 'master-item-list' %}">&laquo; Vissza</a>
    <h1>Recept√∫ra Szerkeszt√©se</h1>

    <div class="item-info">
        <h2>{{ master_item.tetelszam }}</h2>
        <p>{{ master_item.leiras }}</p>
        <hr>
        <div style="display:flex; gap:20px;">
            <span>Anyag: <strong>{{ master_item.fix_anyag_ar|floatformat:0|intcomma }} Ft</strong></span>
            <span>D√≠j: <strong>{{ master_item.fix_munkadij|floatformat:0|intcomma }} Ft</strong></span>
            <span>G√©p: <strong>{{ master_item.fix_gep_ar|floatformat:0|intcomma }} Ft</strong></span>
        </div>
    </div>

    <h3>üß± Anyagok</h3>
    <table>
        <thead><tr><th>Megnevez√©s</th><th>Egys√©g√°r</th><th>Mennyis√©g</th><th>T√∂rl√©s</th></tr></thead>
        <tbody>
            {% for c in materials %}
            <tr><td>{{ c.material }}</td><td>{{ c.material.price }}</td><td>{{ c.amount }}</td><td><a href="{% url 'master-item-component-delete' c.id %}" style="color:red;">X</a></td></tr>
            {% empty %}<tr><td colspan="4" style="color:#999; text-align:center;">Nincs anyag.</td></tr>{% endfor %}
        </tbody>
    </table>
    <form method="POST" class="add-form">
        {% csrf_token %}
        <div style="flex:3">{{ mat_form.material }}</div>
        <div style="flex:1">{{ mat_form.amount }}</div>
        <button type="submit" name="submit_mat" class="btn-add">+ Anyag</button>
    </form>

    <h3>üë∑ Munkad√≠j</h3>
    <table>
        <thead><tr><th>M≈±velet</th><th>√ìrad√≠j</th><th>Norma (√≥ra)</th><th>T√∂rl√©s</th></tr></thead>
        <tbody>
            {% for c in labor %}
            <tr><td>{{ c.operation }}</td><td>{{ c.operation.hourly_rate }}</td><td>{{ c.time_required }}</td><td><a href="{% url 'master-item-component-delete' c.id %}" style="color:red;">X</a></td></tr>
            {% empty %}<tr><td colspan="4" style="color:#999; text-align:center;">Nincs munka.</td></tr>{% endfor %}
        </tbody>
    </table>
    <form method="POST" class="add-form">
        {% csrf_token %}
        <div style="flex:3">{{ lab_form.operation }}</div>
        <div style="flex:1">{{ lab_form.time_required }}</div>
        <button type="submit" name="submit_lab" class="btn-add">+ Munka</button>
    </form>

    <h3>üöú G√©pek</h3>
    <table>
        <thead><tr><th>G√©p</th><th>K√∂lts√©g</th><th>Haszn√°lat</th><th>T√∂rl√©s</th></tr></thead>
        <tbody>
            {% for c in machines %}
            <tr><td>{{ c.machine }}</td><td>{{ c.machine.price }}</td><td>{{ c.amount }}</td><td><a href="{% url 'master-item-component-delete' c.id %}" style="color:red;">X</a></td></tr>
            {% empty %}<tr><td colspan="4" style="color:#999; text-align:center;">Nincs g√©p.</td></tr>{% endfor %}
        </tbody>
    </table>
    <form method="POST" class="add-form">
        {% csrf_token %}
        <div style="flex:3">{{ mach_form.machine }}</div>
        <div style="flex:1">{{ mach_form.amount }}</div>
        <button type="submit" name="submit_mach" class="btn-add">+ G√©p</button>
    </form>
</div>
{% endblock %}