{% extends 'projects/base.html' %}

{% block title %}Tétel Szerkesztése{% endblock %}

{% block breadcrumbs %}
    <a href="{% url 'project-detail' project.id %}#budget">{{ project.name }}</a> / <span>Tétel</span>
{% endblock %}

{% block extra_css %}
<style>
    .form-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
    .main-card { background: #fff; padding: 30px; border-radius: 8px; border: 1px solid var(--border); }
    .side-card { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid var(--border); height: fit-content; }

    h3 { margin-top: 0; color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
    label { display: block; font-weight: 600; margin-bottom: 5px; color: #555; font-size: 0.9em; }
    input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    input:focus, select:focus, textarea:focus { border-color: var(--primary); outline: none; }

    .btn { padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; border: none; text-decoration: none; display: inline-block; }
    .btn-primary { background: #005a9c; color: white; }
    .btn-primary:hover { background: #00447c; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-secondary:hover { background: #545b62; }

    .helper-text { font-size: 0.85em; color: #666; margin-top: 5px; }
</style>
{% endblock %}

{% block content %}

<form method="POST">
    {% csrf_token %}

    <div class="form-grid">

        <div class="main-card">
            <h3>Tétel Alapadatok</h3>

            <div style="margin-bottom: 15px;">
                <label>Fejezet</label>
                {{ form.chapter }}
            </div>

            <div style="margin-bottom: 15px;">
                <label>Megnevezés / Leírás *</label>
                {{ form.leiras }}
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label>Mennyiség *</label>
                    {{ form.mennyiseg }}
                </div>
                <div>
                    <label>Egység (pl. m2)</label>
                    {{ form.egyseg }}
                </div>
                <div>
                    <label>Normaidő (óra/egység)</label>
                    {{ form.normaido }}
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label>Anyag Egységár (Ft)</label>
                {{ form.anyag_egysegar }}
            </div>

            <div style="margin-bottom: 15px;">
                <label>Megjegyzés</label>
                {{ form.megjegyzes }}
            </div>

            <div style="margin-top: 30px; display: flex; justify-content: flex-end; gap: 10px;">
                <a href="{% url 'project-detail' project.id %}#budget" class="btn btn-secondary">Mégse</a>
                <button type="submit" class="btn btn-primary">{{ submit_label|default:"Mentés" }}</button>
            </div>
        </div>

        <div class="side-card">
            <h3>Beállítások</h3>

            <label>Szakma (Munkanem)</label>
            {{ form.munkanem }}

            <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">

            <label>Alvállalkozó</label>
            {{ form.alvallalkozo }}

            <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">

            <label>Központi Anyag (Törzs)</label>
            {{ form.material }}

            <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">

            <label>Elkészültség (%)</label>
            {{ form.progress_percentage }}

            <label>Saját munka arány (%)</label>
            {{ form.labor_split_percentage }}
            <div class="helper-text">100% = Csak saját, 0% = Csak alvállalkozó</div>

            <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div><label>ENGY Kód</label>{{ form.engy_kod }}</div>
                <div><label>K Jelző</label>{{ form.k_jelzo }}</div>
            </div>
            <div style="margin-top: 10px;">
                <label>CPR Kód</label>{{ form.cpr_kod }}
            </div>
        </div>
    </div>
</form>

{% endblock %}